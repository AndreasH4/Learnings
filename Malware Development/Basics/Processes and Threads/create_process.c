#include <stdio.h>
#include <Windows.h>

int main(void) {
    STARTUPINFOW si = { 0 };
    PROCESS_INFORMATION pi = { 0 };

    LPCWSTR applicationName = L"C:\\Windows\\System32\\notepad.exe";
    LPCWSTR commandLine = L"C:\\Users\\MALDEV01\\Desktop\\test.txt";

    WCHAR fullCommandLine[MAX_PATH];
    swprintf(fullCommandLine, MAX_PATH, L"%s %s", applicationName, commandLine);

    // Create the process
    if (!CreateProcessW(
        applicationName,          // Application name
        fullCommandLine,         // Command line arguments
        NULL,                    // Process security attributes
        NULL,                    // Thread security attributes
        FALSE,                  // Inherit handles
        BELOW_NORMAL_PRIORITY_CLASS, // Creation flags
        NULL,                    // Environment
        NULL,                    // Current directory
        &si,                     // Startup information
        &pi                      // Process information
    )) {
        printf("(-) failed to create process, error: %ld\n", GetLastError());
        return EXIT_FAILURE;
    }

    printf("(+) process started! pid: %ld\n", pi.dwProcessId);

    WaitForSingleObject(pi.hProcess, INFINITE);
    CloseHandle(pi.hProcess);
    CloseHandle(pi.hThread);

    return EXIT_SUCCESS;
}
